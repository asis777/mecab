name: Update Documents

on:
  pull_request: {}
  push: {}

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: install hugo
        run: |
          curl -sSL https://github.com/gohugoio/hugo/releases/download/v0.62.2/hugo_0.62.2_Linux-64bit.tar.gz > hugo.tar.gz
          tar xf hugo.tar.gz
          sudo mv hugo /usr/local/bin/
      - name: install doxygen help2man man2html
        run: sudo apt-get install doxygen help2man man2html
      - name: generate documents
        run: |
          rm -rf docs
          rm -rf mecab/doc
          hugo
          doxygen mecab.cfg
          cp -r docs mecab/docs
      - name: build mecab
        run: |
          ./configure
          make
        working-directory: mecab
      - run: |
          make update-man
          man2html mecab.1 > ../doc/mecab.html
          cp ../doc/mecab.html ../../docs/mecab.html
        working-directory: mecab/man
      - run: |
          BRANCH=update-docs-test-$(date +"%Y-%m-%d-%H-%M-%S")
          git config --global user.name "Ichinose Shogo"
          git config --global user.email shogo82148@gmail.com
          git add docs mecab/doc mecab/man/mecab.1
          git commit -m "auto generate documents $(date +"%Y-%m-%d %H:%M:%S")" || ( echo "no updates" && exit 0 )
          git push -u origin $BRANCH
